var G=Object.defineProperty;var F=(o,e,n)=>e in o?G(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var c=(o,e,n)=>(F(o,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(t){if(t.ep)return;t.ep=!0;const r=n(t);fetch(t.href,r)}})();class y{constructor(e){c(this,"speed",4);c(this,"body",[[]]);c(this,"position",{x:0,y:0});this.position=e}}class S extends y{constructor(){super(...arguments);c(this,"speed",4);c(this,"body",[[1,1,1,1,1],[0,0,1,0,0],[0,1,0,1,0],[0,0,1,0,0],[1,1,1,1,1]])}}c(S,"width",5);class L extends y{constructor(){super(...arguments);c(this,"speed",2);c(this,"body",[[1,3,2,3,1],[2,0,0,0,2],[2,0,0,2,0],[2,0,0,0,2],[1,3,2,3,1]])}}c(L,"width",5);class C extends y{constructor(){super(...arguments);c(this,"speed",6);c(this,"body",[[2,0,1,0,1],[0,1,0,1,0],[2,0,1,0,1]])}}c(C,"width",3);class M extends y{constructor(){super(...arguments);c(this,"speed",1);c(this,"body",[[4,3,2,2,2],[0,2,3,0,0],[0,3,0,4,4],[0,2,3,0,0],[4,3,2,2,2]])}}c(M,"width",5);const b=[S,L,C,M],d=document.getElementById("gamecanvas");if(!d)throw"no gameScreen";const m=d.getContext("2d");if(!m)throw"no context";const h=document.getElementById("startgame");if(!h)throw"no startGame";const p=document.getElementById("gameover");if(!p)throw"no gameOver";const g=document.getElementById("current-hitpoints");if(!g)throw"no currentHPElement";const N=document.getElementById("max-hitpoints");if(!N)throw"no maxHPElement";const W=Number(N.innerText),w=document.getElementById("score");if(!w)throw"no scoreElement";const O=document.getElementById("finalscore");if(!O)throw"no finalscoreElement";const T=document.getElementById("again");if(!T)throw"no againElement";const H=()=>Number(w.innerText),P=o=>w.innerText=o(H()).toString(),A=()=>Number(g.innerText),R=o=>g.innerText=o(A()).toString(),i=4,x=500,v=500,B=x/i,D=v/i;d.width=v;d.height=x;const X="lightblue",U="white",k=["red","orange","blue","purple","black"],q=.01,K=()=>Array.from({length:D}).map(()=>Array(B).fill(!1)),E=o=>{m.fillStyle=X,o.forEach((e,n)=>e.forEach((s,t)=>{s&&m.fillRect(n*i,t*i,i,i)}))},I=()=>{m.fillStyle=U,m.fillRect(0,0,v,x)},Q=(o,e,n)=>{var u;const s=Math.abs(n.x-e.x),t=Math.abs(n.y-e.y),r=e.x<n.x?1:-1,l=e.y<n.y?1:-1;let a=s-t;for(;((u=o[e.x])==null?void 0:u[e.y])!==void 0&&(o[e.x][e.y]=!0),!(e.x===n.x&&e.y===n.y);){const f=2*a;f>-t&&(a-=t,e.x+=r),f<s&&(a+=s,e.y+=l)}},z=o=>{o.body.forEach((e,n)=>e.forEach((s,t)=>{s!==0&&(m.fillStyle=k[s-1],m.fillRect((n+o.position.x)*i,(t+o.position.y)*i,i,i))}))},J=(o,e)=>{e[Math.floor(o.offsetX/i)][Math.floor(o.offsetY/i)]=!0,E(e);const n=s=>{Q(e,{x:Math.floor((s.offsetX-s.movementX)/i),y:Math.floor((s.offsetY-s.movementY)/i)},{x:Math.floor(s.offsetX/i),y:Math.floor(s.offsetY/i)}),E(e)};d.addEventListener("mousemove",n),d.addEventListener("mouseup",()=>d.removeEventListener("mousemove",n),{once:!0})},V=(o,e)=>{let n=0;o.forEach(t=>{for(let r=0;r<=t.speed;r++)t.body.forEach((l,a)=>l.forEach((u,f)=>{if(u!==0){if(f+t.position.y+r>=B){n+=t.body[a][f],t.body[a][f]=0;return}e[a+t.position.x][f+t.position.y+r]&&(e[a+t.position.x][f+t.position.y+r]=!1,t.body[a][f]=u-1,P(Y=>Y+1))}}));t.position.y+=t.speed}),R(t=>t-n>0?t-n:0);let s=0;for(;s<o.length;){if(!o[s].body.some(t=>t.some(r=>r>0))){o.splice(s,1);continue}s++}},Z=(o,e,n)=>{o.push(new e({x:n,y:0}))},$=o=>{const e=1-1/(o*q+1);if(Math.random()>e)return null;const n=Math.floor(Math.random()*b.length);return b[n]},j=(o,e)=>{const n=$(o);n&&Z(e,n,Math.floor(Math.random()*(D-n.width)))},_=async()=>{p.style.display="none",h.style.display="none",d.style.display="block",P(()=>0),R(()=>W);const o=[],e=K(),n=[],s=l=>J(l,e);d.addEventListener("mousedown",s),o.push(()=>d.removeEventListener("mousedown",s));let t=0;const r=await new Promise(l=>{I();const a=setInterval(()=>{V(n,e),j(t,n),t++,I(),E(e),n.forEach(u=>z(u)),A()===0&&l(H())},100);o.push(()=>clearInterval(a))});O.innerText=r.toString(),p.style.display="grid",h.style.display="none",d.style.display="none",o.forEach(l=>l())};h.addEventListener("click",_);T.addEventListener("click",_);
